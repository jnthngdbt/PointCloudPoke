# PointCloudVisualizer

How to build from source:

1. Clone https://github.com/jnthngdbt/PointCloudVisualizer.git
2. CMake (e.g. cmake-gui) configure + generate in `.\bin`
3. Open solution and run

# Introduction

This project offers tools to help for 3D point cloud development, investigation and debugging. It is composed of the following components:

- `VisualizerData`: class that manages exporting point cloud data to *.pcd files. This is what is used anywhere in the code to export versions of point clouds during processing. It was designed for a debugging mindset, so to have the smallest code footprint as possible. All the methods and modifiers can be chained for easy oneliners.
- `Visualizer`: class that derives from pcl::visualization::PCLVisualizer. It manages reading and visualizing files generated by `VisualizerData` and augments features offered by PCL's PCD viewer.
- `VisualizerApp`: the executable program version of `Visualizer`.
- `VisualizerTest`: project used for test-driven development. It also demonstrates how to use VisualizerData.

# VisualizerData

## Example: visualizing voxel grid processing result

You can create an instance using

    VISUALIZER_CALL(pcv::VisualizerData viewer("voxelize"));

You can export a version of the cloud before processing

    VISUALIZER_CALL(viewer.addCloud(*cloud, "0-cloud-in").setColorGray(.3).setOpacity(.8));

After doing the processing, you can visualize the result

    VISUALIZER_CALL(viewer.addCloud(*cloudOut, "1-cloud-out").setColor(1,0,0));

In a folder named VisualizerData located in your running project root, you will get the following files

    ...\VisualizerData\visualizer.20210310.140854.366.(voxelize).0-cloud-in.pcd
    ...\VisualizerData\visualizer.20210310.140854.537.(voxelize).1-cloud-out.pcd

## Activation

Since it is mainly a development and debugging tool, most of the time you do not want code related to VisualizerData to be included in the production code. So, all calls related to VisualizerData are encapsulated with a preprocessor macro `VISUALIZER_CALL` that will either include or skip the code. 

In some header, you can have to following logic for easy control on whether or not to activate the `VisualizerData` code

    #define VISUALIZER // comment this to deactivate VisualizerData

    #ifdef VISUALIZER
      #include "VisualizerData.h"
      #define VISUALIZER_CALL(x) x
    #else
      #define VISUALIZER_CALL(x)
    #endif

So if `VISUALIZER` is commented, `VisualizerData.h` is not included and all code encapsulated with `VISUALIZER_CALL` will be ignored by the preprocessor.

# Packaging VisualizerApp

The script `package.bat` creates a standalone bundle of the `VisualizerApp` that can be shared or copied on a computer that does not need to have PCL installed.

In order to work, you must have built the `VisualizerApp` from source such that the file `.\bin\Release\VisualizerApp.exe` exists.

To test if the setup is ok, run the batch file `[...]\package\VisualizerAppTest\test.bat` by double clicking on it. The `VisualizerApp` should launch and visualize test data.

# VisualizerApp

Once you have `VisualizerApp` installed (either by compiling from source or from a built package) the simplest way to use it is to associate PCD files with VisualizerApp.exe (right-click on a PCD file > Properties > Opens with...), located at `[...]\package\VisualizerApp\VisualizerApp.exe`.

## Important interactive commands

All commands should be displayed in the console when pressing 'h'. It first shows all original commands available in `pcl_viewer_release.exe`. The bottom section shows commands specific to `VisualizerApp`. Following are the most important and useful.

### PCL builtin

* **r**: Recenters the viewpoint to the centroid of the cloud and scales to view the entire cloud. This should be the first key pressed when you open the viewer and you see nothing.
* **f**: When hovering over a point with the mouse, it centers the viewpoint on that point.
* **numkeys**: Switches color handlers to color the points. Every feature is a color handler. If more than 10, combine with CTRL.
* **l**: List color handlers in the console.
* **o**: Toggle orthogonal/perspective view.
* **u**: Toggle display of the colormap.
  
### New with VisualizerApp

* **i**: Loop through all clouds and highlight them. The highlighted cloud's name is displayed. Combine with SHIFT to go backwards. Combine with CTRL to exit.
* **left/right arrows**: Navigate through cloud bundles, corresponding to scopes in the code.

# PCL's viewer

`VisualizerApp` is a kind of wrapper over the functionalities of PCL's `pcl_viewer_release` (`pcl_viewer` for newest versions of PCL). All PCD files generated by BFMeasurement are valid PCD files, so they can also be opened in the barebone `pcl_viewer_release`. 

If you have installed PCL from binaries, you have access to `"C:\Program Files\<PCL version>\bin\pcl_viewer.exe"`.

If you have a packaged version of the `VisualizerApp`, the PCL viewer tool is packaged with it at `[...]\package\VisualizerApp\pcl_viewer_release.exe`.

To have a quick access to the viewer, drag and drop a shortcut to the following batch file `[...]\package\VisualizerApp\pcl_viewer.bat` in the quick access section of your Windows toolbar. When you want to visualize one or more PCD files using the `pcl_viewer_release.exe`, simply select the files and drag'n drop them on the shortcut in the quick access.
